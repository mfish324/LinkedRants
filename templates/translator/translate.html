{% extends 'base.html' %}

{% block title %}LinkedIn Translator{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold mb-4">
            <span class="bg-gradient-to-r from-primary-400 to-accent-400 bg-clip-text text-transparent">
                The LinkedIn Translator
            </span>
        </h1>
        <p class="text-xl text-gray-400 mb-2">Transform between honest thoughts and LinkedIn-speak.</p>
    </div>

    {% if error %}
    <div class="bg-red-900/50 border border-red-700 text-red-200 px-4 py-3 rounded-lg mb-6">
        {{ error }}
    </div>
    {% endif %}

    <!-- Mode selector -->
    <div class="flex justify-center mb-6">
        <div class="inline-flex bg-gray-800 rounded-lg p-1" id="mode-selector">
            <button type="button"
                    onclick="setMode('to_linkedin')"
                    id="btn-to-linkedin"
                    class="px-6 py-3 rounded-lg transition font-medium bg-primary-600 text-white">
                Make it LinkedIn
            </button>
            <button type="button"
                    onclick="setMode('to_reality')"
                    id="btn-to-reality"
                    class="px-6 py-3 rounded-lg transition font-medium text-gray-400 hover:text-white">
                Make it Real
            </button>
        </div>
    </div>

    <!-- Translator form - side by side -->
    <form method="post" id="translator-form" onsubmit="showLoading()">
        {% csrf_token %}
        <input type="hidden" name="mode" id="mode-input" value="to_linkedin">

        <div class="flex items-stretch gap-4">
            <!-- Left side: Input -->
            <div class="flex-1">
                <label id="input-label" class="block text-sm font-medium text-gray-400 mb-2">
                    Your honest thought:
                </label>
                <textarea name="text"
                          id="input-text"
                          rows="10"
                          class="form-textarea text-lg h-64 resize-none"
                          placeholder="Write what you actually want to say..."
                          required>{{ original_text|default:'' }}</textarea>
            </div>

            <!-- Middle: Translate button -->
            <div class="flex items-center">
                <button type="submit"
                        id="translate-btn"
                        class="bg-accent-500 hover:bg-accent-600 text-white px-6 py-4 rounded-lg font-semibold transition flex flex-col items-center gap-2">
                    <span class="text-2xl">&#x2192;</span>
                    <span>Translate</span>
                </button>
            </div>

            <!-- Right side: Output -->
            <div class="flex-1">
                <div class="flex justify-between items-center mb-2">
                    <label id="output-label" class="block text-sm font-medium text-primary-400">
                        The LinkedIn version:
                    </label>
                    {% if powered_by %}
                    <span class="text-xs text-gray-500">Powered by {{ powered_by }}</span>
                    {% endif %}
                </div>
                <div id="output-container" class="relative">
                    <div id="output-text"
                         class="form-textarea h-64 overflow-y-auto whitespace-pre-wrap {% if translated_text and 'Translation failed' not in translated_text %}bg-primary-900/20 border-primary-800{% endif %}">{% if translated_text %}{{ translated_text }}{% else %}<span class="text-gray-500 italic">Translation will appear here...</span>{% endif %}</div>

                    <!-- Loading Spinner (hidden by default) -->
                    <div id="loading-spinner" class="hidden absolute inset-0 bg-gray-900/90 rounded-lg flex flex-col items-center justify-center">
                        <div class="relative">
                            <div class="w-16 h-16 border-4 border-gray-700 border-t-accent-500 rounded-full animate-spin"></div>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <span class="text-xl">&#x1F4BC;</span>
                            </div>
                        </div>
                        <p id="loading-message" class="mt-6 text-gray-400 text-center text-sm italic max-w-xs transition-opacity duration-200"></p>
                    </div>
                </div>
            </div>
        </div>

        {% if translation and 'Translation failed' not in translated_text %}
        <!-- Share link -->
        <div class="flex items-center justify-center gap-4 mt-6">
            <button type="button"
                    onclick="navigator.clipboard.writeText(document.getElementById('output-text').textContent); this.textContent='Copied!';"
                    class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition">
                Copy Translation
            </button>
            <a href="{{ translation.get_absolute_url }}"
               class="text-primary-400 hover:text-primary-300">
                Share this translation &#x2192;
            </a>
        </div>
        {% endif %}
    </form>

    <!-- Examples -->
    <div class="mt-10 text-center">
        <h3 class="text-sm font-medium text-gray-500 mb-3">Try an example:</h3>
        <div class="flex flex-wrap justify-center gap-2">
            <button type="button"
                    onclick="document.getElementById('input-text').value = 'I got laid off today. I am stressed about paying rent and scared about the future.';"
                    class="text-sm bg-gray-800 hover:bg-gray-700 px-3 py-1.5 rounded-full transition">
                "I got laid off..."
            </button>
            <button type="button"
                    onclick="document.getElementById('input-text').value = 'My boss takes credit for all my work and I am sick of it.';"
                    class="text-sm bg-gray-800 hover:bg-gray-700 px-3 py-1.5 rounded-full transition">
                "My boss takes credit..."
            </button>
            <button type="button"
                    onclick="document.getElementById('input-text').value = 'I hate networking events. They are awkward and fake.';"
                    class="text-sm bg-gray-800 hover:bg-gray-700 px-3 py-1.5 rounded-full transition">
                "I hate networking..."
            </button>
        </div>
    </div>
</div>

<script>
// Funny loading messages
const LOADING_MESSAGES = [
    // Workplace waiting
    "Kinda like waiting for that raise, isn't it?",
    "Spinning wheel, just like that hamster wheel you're on at work.",
    "Still faster than HR getting back to you.",
    "Loading... like your motivation on Monday morning.",
    "Please hold, your translation is very important to us.",
    "Buffering... unlike your manager's promises.",
    "Almost there, unlike your career progression.",
    "Processing... faster than your expense reimbursement.",

    // Job search waiting
    "Waiting... just like after that 'great' interview.",
    "Any moment now... unlike that job application response.",
    "Still quicker than a recruiter follow-up.",
    "Loading faster than LinkedIn loads ghost jobs.",
    "Hang tight, unlike your last employer.",
    "Working on it... unlike that 'urgent' hire.",

    // LinkedIn specific
    "Translating corporate speak... please wait.",
    "Converting authenticity to buzzwords...",
    "Injecting gratitude and humility...",
    "Adding unnecessary line breaks...",
    "Calculating optimal emoji placement...",
    "Generating thought leadership...",
    "Optimizing for engagement...",
    "Removing all traces of personality...",
    "Making it about the journey...",

    // Corporate jargon
    "Synergizing your content...",
    "Leveraging AI to maximize cringe...",
    "Disrupting your authentic thoughts...",
    "Pivoting your message to stakeholders...",
    "Taking this offline to process...",
    "Let's circle back in a moment...",
    "Putting this in the parking lot briefly...",
    "Moving the needle...",
    "Boiling the ocean...",

    // Existential
    "This is fine. Everything is fine.",
    "Contemplating the void... and your career choices.",
    "Finding meaning in corporate platitudes...",
];

let messageInterval = null;

function getRandomMessage(exclude = null) {
    let message;
    do {
        message = LOADING_MESSAGES[Math.floor(Math.random() * LOADING_MESSAGES.length)];
    } while (message === exclude && LOADING_MESSAGES.length > 1);
    return message;
}

function showLoading() {
    const spinner = document.getElementById('loading-spinner');
    const messageEl = document.getElementById('loading-message');
    const translateBtn = document.getElementById('translate-btn');

    // Show spinner
    spinner.classList.remove('hidden');
    translateBtn.disabled = true;
    translateBtn.querySelector('span:last-child').textContent = 'Working...';

    // Set initial message
    messageEl.textContent = getRandomMessage();
    messageEl.style.opacity = '1';

    // Rotate messages every 3 seconds
    messageInterval = setInterval(() => {
        messageEl.style.opacity = '0';
        setTimeout(() => {
            messageEl.textContent = getRandomMessage(messageEl.textContent);
            messageEl.style.opacity = '1';
        }, 200);
    }, 3000);
}

function hideLoading() {
    const spinner = document.getElementById('loading-spinner');
    const translateBtn = document.getElementById('translate-btn');

    spinner.classList.add('hidden');
    translateBtn.disabled = false;
    translateBtn.querySelector('span:last-child').textContent = 'Translate';

    if (messageInterval) {
        clearInterval(messageInterval);
        messageInterval = null;
    }
}

function setMode(mode) {
    document.getElementById('mode-input').value = mode;

    const btnLinkedin = document.getElementById('btn-to-linkedin');
    const btnReality = document.getElementById('btn-to-reality');
    const inputLabel = document.getElementById('input-label');
    const outputLabel = document.getElementById('output-label');
    const inputText = document.getElementById('input-text');

    if (mode === 'to_linkedin') {
        btnLinkedin.className = 'px-6 py-3 rounded-lg transition font-medium bg-primary-600 text-white';
        btnReality.className = 'px-6 py-3 rounded-lg transition font-medium text-gray-400 hover:text-white';
        inputLabel.textContent = 'Your honest thought:';
        outputLabel.textContent = 'The LinkedIn version:';
        inputText.placeholder = 'Write what you actually want to say...';
    } else {
        btnReality.className = 'px-6 py-3 rounded-lg transition font-medium bg-primary-600 text-white';
        btnLinkedin.className = 'px-6 py-3 rounded-lg transition font-medium text-gray-400 hover:text-white';
        inputLabel.textContent = 'The LinkedIn post:';
        outputLabel.textContent = 'What they actually meant:';
        inputText.placeholder = 'Paste that cringey LinkedIn post here...';
    }
}

// Set initial mode from server if provided
{% if mode == 'to_reality' %}
setMode('to_reality');
{% endif %}

// Hide loading if page loaded with results (form was submitted)
{% if translated_text %}
// Page has results, no need for spinner
{% else %}
// Fresh page, spinner will show on submit
{% endif %}
</script>
{% endblock %}
